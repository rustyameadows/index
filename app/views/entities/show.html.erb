<div style="display:grid; grid-template-columns: 1fr 1.5fr; gap:1.25rem; align-items:start;">
  <div>
    <h1><%= @entity.name %></h1>
    <p style="color:#555; margin:0.25rem 0 0.75rem 0;">
      <span style="padding:0.2rem 0.45rem; border:1px solid #ddd; border-radius:4px; font-size:0.9rem; color:#444;"><%= @entity.category.titleize %></span>
    </p>
    <div style="margin-bottom:1rem; white-space:pre-line;"><%= @entity.description.presence || "No description." %></div>

    <div style="display:flex; gap:0.75rem; flex-wrap:wrap;">
      <%= link_to "Edit", edit_project_entity_path(@project, @entity), style: "text-decoration:none; padding:0.45rem 0.8rem; border:1px solid #ddd; border-radius:6px;" %>
      <%= link_to "Back to entities", project_entities_path(@project), style: "text-decoration:none; padding:0.45rem 0.8rem; border:1px solid #ddd; border-radius:6px;" %>
      <%= button_to "Delete", project_entity_path(@project, @entity), method: :delete, data: { confirm: "Delete this entity?" }, form: { style: "display:inline" }, class: "link-button" %>
    </div>
  </div>

  <div data-controller="entity-carousel">
    <h2 style="margin-top:0;">Related uploads</h2>
    <% if @entity_uploads.any? %>
      <% primary = @entity_uploads.first %>
      <div style="border:1px solid #eee; padding:0.5rem; border-radius:6px; margin-bottom:0.75rem; background:#fafafa;">
        <%= image_tag url_for(primary.file), alt: primary.original_filename, style: "width:100%; height:380px; object-fit:contain; display:block;", data: { entity_carousel_target: "display" } %>
      </div>
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
        <div data-entity-carousel-target="caption" style="color:#555; font-size:0.95rem;"><%= primary.original_filename %></div>
        <%= link_to "View upload", project_upload_path(@project, primary), data: { entity_carousel_target: "openLink" }, style: "text-decoration:none; padding:0.35rem 0.65rem; border:1px solid #ddd; border-radius:6px;" %>
      </div>
      <div style="display:flex; gap:8px; overflow-x:auto; padding-bottom:0.5rem;">
        <% @entity_uploads.each do |upload| %>
          <button
            type="button"
            style="flex:0 0 auto; width:80px; border:1px solid #eee; border-radius:4px; padding:4px; background:#fff; cursor:pointer;"
            data-entity-carousel-target="thumb"
            data-action="click->entity-carousel#select"
            data-full-url="<%= url_for(upload.file) %>"
            data-upload-url="<%= project_upload_path(@project, upload) %>"
            data-filename="<%= upload.original_filename %>"
            data-alt="<%= upload.original_filename %>">
            <%= image_tag url_for(upload.file), alt: upload.original_filename, style: "width:100%; height:70px; object-fit:cover; display:block;" %>
          </button>
        <% end %>
      </div>
    <% else %>
      <p>No uploads linked yet.</p>
    <% end %>
  </div>
</div>
